# ==========================================
# InvestIQ Environment Configuration
# ==========================================
# Copy this file to .env and fill in your values:
#   cp .env.example .env
#

# ==========================================
# REQUIRED: Polygon.io API Key
# ==========================================
# Get your API key at: https://polygon.io/dashboard/signup
# Starter plan ($29/mo) includes:
#   - Unlimited API calls (recommend <6000 req/min)
#   - Real-time stock market data
#   - Historical data, news, and fundamentals
# Free tier: 5 API calls per minute (set POLYGON_RATE_LIMIT=5)
#
# Example: POLYGON_API_KEY=abc123xyz456def789
POLYGON_API_KEY=your_polygon_api_key_here


# ==========================================
# OPTIONAL: Alpha Vantage API Key (for Validation)
# ==========================================
# Only required if using the validation/comparison features
# Get your FREE API key at: https://www.alphavantage.co/support/#api-key
# Free tier includes:
#   - 25 API calls per day
#   - Technical indicators (RSI, MACD, SMA, etc.)
#   - Fundamental data
#
# This allows you to:
#   - Compare our technical indicators with Alpha Vantage's
#   - Validate fundamental data against Yahoo Finance
#   - See accuracy metrics for our analysis
#
# Example: ALPHA_VANTAGE_API_KEY=ABC123XYZ456
ALPHA_VANTAGE_API_KEY=your_alpha_vantage_api_key_here


# ==========================================
# OPTIONAL: Discord Bot Integration
# ==========================================
# Only required if using the Discord bot feature
# Get your bot token at: https://discord.com/developers/applications
#
# Steps:
#   1. Create new application
#   2. Go to "Bot" tab → "Add Bot"
#   3. Enable "Message Content Intent"
#   4. Copy the token
#   5. Invite bot to your server (see DISCORD_BOT_GUIDE.md)
#
# Example: DISCORD_BOT_TOKEN=MTIzNDU2Nzg5MDEyMzQ1Njc4OQ.AbCdEf.GhIjKlMnOpQrStUvWxYz123456
DISCORD_BOT_TOKEN=your_discord_bot_token_here


# ==========================================
# OPTIONAL: Redis Caching
# ==========================================
# Redis provides distributed caching for better performance
# If not set, the system will use in-memory caching (works fine for single instance)
#
# Default: redis://localhost:6379
# Start Redis: docker-compose up -d
#
# Examples:
#   Local:  redis://localhost:6379
#   Remote: redis://username:password@hostname:6379
#   Cloud:  redis://default:password@redis-12345.cloud.redislabs.com:12345
#
REDIS_URL=redis://localhost:6379


# ==========================================
# REQUIRED: API Authentication
# ==========================================
# Comma-separated list of valid API keys for authentication
# Generate secure random keys (e.g., using: openssl rand -hex 32)
#
# Example: API_KEYS=abc123def456ghi789,xyz987uvw654rst321
# IMPORTANT: Keep these keys secret and never commit them to version control
API_KEYS=your_api_key_1,your_api_key_2

# ==========================================
# OPTIONAL: Alpaca Broker (Paper Trading)
# ==========================================
# Sign up at: https://app.alpaca.markets/signup
# Use the paper trading URL for safe testing.
#
# APCA_API_KEY_ID=your_alpaca_api_key_here
# APCA_API_SECRET_KEY=your_alpaca_secret_key_here
# ALPACA_BASE_URL=https://paper-api.alpaca.markets

# ==========================================
# OPTIONAL: Live Trading Safety
# ==========================================
# Required ONLY if switching from paper to live trading.
# If ALPACA_BASE_URL is NOT paper-api, the server refuses to start
# unless LIVE_TRADING_APPROVED=yes is set.
#
# LIVE_TRADING_APPROVED=yes
# LIVE_TRADING_KEY=your_live_trading_key_here

# ==========================================
# OPTIONAL: API Server Configuration
# ==========================================
# Uncomment and modify these if you need custom settings

# Host binding (default: 0.0.0.0 - all interfaces)
# API_HOST=0.0.0.0

# Default cache TTL in seconds (default: 300 = 5 minutes)
# CACHE_TTL=300

# Log level: trace, debug, info, warn, error (default: info)
# RUST_LOG=info

# Rate limiting: requests per minute per IP (default: 120)
# RATE_LIMIT_PER_MINUTE=120

# CORS allowed origins (comma-separated, default: http://localhost:3000,http://localhost:8050)
# For production, set this to your actual frontend domains
# ALLOWED_ORIGINS=https://yourdomain.com,https://app.yourdomain.com


# ==========================================
# OPTIONAL: API Server Security Hardening
# ==========================================
# These settings harden the API server for public exposure.
# All have safe defaults — only configure what you need.

# --- TLS (HTTPS) ---
# Provide PEM cert+key paths to enable native HTTPS.
# If not set, the server binds plain HTTP (use behind a reverse proxy).
# TLS_CERT_PATH=/path/to/cert.pem
# TLS_KEY_PATH=/path/to/key.pem

# Enable HSTS header (only useful when serving HTTPS directly)
# ENABLE_HSTS=true

# --- Request Timeout ---
# Hard timeout for all requests in seconds (default: 30)
# REQUEST_TIMEOUT_SECS=30

# --- Brute-Force Protection ---
# Locks out IPs after repeated auth failures.
# AUTH_MAX_FAILURES=5              # Failures before lockout (default: 5)
# AUTH_FAILURE_WINDOW_SECS=300     # Tracking window in seconds (default: 300 = 5 min)
# AUTH_LOCKOUT_SECS=900            # Lockout duration in seconds (default: 900 = 15 min)

# --- Admin IP Allowlist ---
# Comma-separated CIDRs. Admin routes only accessible from these IPs.
# If not set, admin routes are open (dev mode).
# ADMIN_IP_ALLOWLIST=10.0.0.0/8,192.168.1.0/24,::1/128

# --- Error Sanitization ---
# Set to "production" to hide internal error details from API responses.
# RUST_ENV=production

# --- Graceful Shutdown ---
# Drain timeout in seconds — in-flight requests finish before server exits.
# SHUTDOWN_TIMEOUT_SECS=30


# ==========================================
# OPTIONAL: Dashboard Configuration
# ==========================================
# Port for the Dash dashboard (default: 8050)
# DASHBOARD_PORT=8050

# Dashboard host (default: 0.0.0.0)
# DASHBOARD_HOST=0.0.0.0

# API endpoint for dashboard to connect to (default: http://localhost:3000)
# API_ENDPOINT=http://localhost:3000


# ==========================================
# Database Backend (plug-and-play)
# ==========================================
# Switch between SQLite and PostgreSQL by changing DATABASE_URL.
# No recompilation needed — just change the URL and restart.
#
# SQLite (default, good for development / single instance):
DATABASE_URL=sqlite:portfolio.db
#
# PostgreSQL (recommended for production / concurrent access):
# DATABASE_URL=postgres://investiq:investiq_dev@localhost:5432/investiq
#
# To use PostgreSQL:
#   1. Start PG: docker compose --profile postgres up -d
#   2. Set DATABASE_URL above to the postgres:// URL
#   3. Restart the API server — migrations run automatically


# ==========================================
# DEVELOPMENT OPTIONS
# ==========================================
# Uncomment these for development/debugging

# Enable debug logging
# RUST_LOG=debug

# Disable caching (forces fresh API calls every time)
# DISABLE_CACHE=true

# Use smaller datasets for faster testing
# TEST_MODE=true


# ==========================================
# NOTES
# ==========================================
# - Never commit your .env file to git (it's in .gitignore)
# - Keep your API keys secret
# - Polygon Starter plan ($29): ~6000 req/min. Free tier: 5 req/min (set POLYGON_RATE_LIMIT=5)
# - Redis is optional but recommended for production
# - All services can run on default ports
#
# Quick Start:
#   1. Add POLYGON_API_KEY (required)
#   2. (Optional) Add DISCORD_BOT_TOKEN for Discord bot
#   3. Run: ./start-all.sh
#
# For detailed setup: See SETUP_GUIDE.md
